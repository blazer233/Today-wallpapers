[{"F:\\code_git\\Today-wallpapers\\src\\index.js":"1","F:\\code_git\\Today-wallpapers\\src\\App.js":"2","F:\\code_git\\Today-wallpapers\\src\\Content\\index.js":"3","F:\\code_git\\Today-wallpapers\\src\\Content\\Content.js":"4"},{"size":204,"mtime":1613964634223,"results":"5","hashOfConfig":"6"},{"size":113,"mtime":1613957683134,"results":"7","hashOfConfig":"6"},{"size":6938,"mtime":1613979319036,"results":"8","hashOfConfig":"6"},{"size":5669,"mtime":1613979360493,"results":"9","hashOfConfig":"6"},{"filePath":"10","messages":"11","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"12"},"14lax4d",{"filePath":"13","messages":"14","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"15","usedDeprecatedRules":"12"},{"filePath":"16","messages":"17","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"18","usedDeprecatedRules":"12"},{"filePath":"19","messages":"20","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"21"},"F:\\code_git\\Today-wallpapers\\src\\index.js",[],["22","23"],"F:\\code_git\\Today-wallpapers\\src\\App.js",["24"],"import React from \"react\";\r\nimport Content from \"./Content\";\r\nexport default () => {\r\n  return <Content />;\r\n};\r\n","F:\\code_git\\Today-wallpapers\\src\\Content\\index.js",["25"],"import React, { useEffect, useState } from \"react\";\r\nimport Content from \"./Content\";\r\nimport { executablePath } from \"../../package.json\";\r\nimport { SyncOutlined } from \"@ant-design/icons\";\r\nimport { Spin, message } from \"antd\";\r\nconst {\r\n  ipcRenderer,\r\n  shell: { openExternal },\r\n  remote: {\r\n    dialog: { showOpenDialogSync },\r\n  },\r\n} = window.require(\"electron\");\r\nconst wallpaper = window.require(\"wallpaper\");\r\nconst puppeteer = window.require(\"puppeteer\");\r\nconst ipcasync = async (name, obj = null) => {\r\n  ipcRenderer.send(name, obj);\r\n  return await new Promise(resolve => {\r\n    ipcRenderer.on(`${name}-reply`, (event, arg) => resolve(arg));\r\n  });\r\n};\r\nconst App = () => {\r\n  const [result, setResult] = useState([]);\r\n  const [isdown, setdown] = useState(false);\r\n  const [details, setDetail] = useState([]);\r\n  const [Modals, setModal] = useState(\"\");\r\n  const [screenSize, setScreenSize] = useState({});\r\n  const [path, setPath] = useState(\"\");\r\n  const [headless, setheadless] = useState(true);\r\n  const [panding, setPanding] = useState(\"\");\r\n  const config = {\r\n    headless,\r\n    executablePath,\r\n    args: [\"--no-sandbox\", \"--disable-setuid-sandbox\"],\r\n  };\r\n  const _init = async (_ = false) => {\r\n    setPanding(\"努力加载中...第一次加载时间会比较长~~~\");\r\n    let res = await ipcasync(\"init-homepage\", _);\r\n    setScreenSize(await ipcasync(\"init-imgsize\"));\r\n    res ? setResult(res) : newFind();\r\n    setPanding(false);\r\n  };\r\n  useEffect(() => _init(), []);\r\n  const getHomePage = async url => {\r\n    let urls = \"http://desk.zol.com.cn/\" + url;\r\n    const browser = await puppeteer.launch(config);\r\n    const page = await browser.newPage();\r\n    await page.goto(urls);\r\n    await page.waitForSelector(\".wrapper\", { visible: true });\r\n    const arr = await page.$$eval(\".main>ul a\", el =>\r\n      el.map(i => ({\r\n        href: \"http://desk.zol.com.cn\" + i.getAttribute(\"href\"),\r\n        srcmini: i.firstChild.getAttribute(\"src\"),\r\n        title: i.firstChild.getAttribute(\"title\"),\r\n        children: [],\r\n      }))\r\n    );\r\n    browser.close();\r\n    return arr;\r\n  };\r\n  const getPages = async (url, screen) => {\r\n    const browser = await puppeteer.launch(config);\r\n    const page = await browser.newPage();\r\n    await page.goto(url);\r\n    const all = await page.$eval(\".wrapper span\", el => el.textContent);\r\n    const allPage = all.split(\"/\")[1].replace(\"）\", \"\");\r\n    console.log(\"开始\", url);\r\n    await page.waitForSelector(\".wrapper\", { visible: true });\r\n    const arr = await page.$$eval(\"#showImg li a\", el =>\r\n      el.map(i => ({\r\n        href: \"http://desk.zol.com.cn\" + i.getAttribute(\"href\"),\r\n        srcmini:\r\n          i.firstElementChild.getAttribute(\"src\") ||\r\n          i.firstElementChild.getAttribute(\"srcs\"),\r\n      }))\r\n    );\r\n    for (let i = 0; i < arr.length; i++) {\r\n      i && setPanding(`总共爬取 ${allPage} 张,当前爬取第 ${i} 张`);\r\n      await page.goto(arr[i].href);\r\n      await page.waitForSelector(`#tagfbl`, { visible: true });\r\n      const hrefItems = await page.evaluate(\r\n        el =>\r\n          document.querySelector(el)\r\n            ? document.querySelector(el).getAttribute(\"href\")\r\n            : document.querySelector(`a[id=\"1920x1080\"]`)\r\n            ? document.querySelector(`a[id=\"1920x1080\"]`).getAttribute(\"href\")\r\n            : document.querySelector(`#tagfbl a`).getAttribute(\"href\"),\r\n        `a[id=\"${screen}\"]`\r\n      );\r\n      await page.goto(\"http://desk.zol.com.cn\" + hrefItems);\r\n      await page.waitForSelector(\"body img\", { visible: true });\r\n      const hrefItem = await page.$eval(\"body img\", el => el.src);\r\n      arr[i].maxsrc = hrefItem;\r\n      details.push(arr[i]);\r\n      setDetail(details);\r\n    }\r\n    setPanding(`爬取完成。请稍后`);\r\n    browser.close();\r\n  };\r\n  const handerchilden = async (title, href) => {\r\n    console.log(title, href, screenSize);\r\n    setModal(title);\r\n    setPanding(\"正在从数据库拉取数据~~~\");\r\n    let res = await ipcasync(\"init-collect\", href);\r\n    if (res) {\r\n      setDetail(res);\r\n    } else {\r\n      try {\r\n        setPanding(\"数据库未查询到，正在拉取新数据~~~\");\r\n        let { width, height } = screenSize;\r\n        let size =\r\n          height < 1100 && height > 1000\r\n            ? `1920x1080`\r\n            : height < 1600 && height > 1100\r\n            ? `2560x1440`\r\n            : height < 1900 && height > 1600\r\n            ? `2880x1800`\r\n            : `${width}x${height}`;\r\n        await getPages(href, size);\r\n      } catch (error) {\r\n        message.info(`网络异常未能全部下载成功`);\r\n        setDetail(details);\r\n      }\r\n      ipcasync(\"init-collect-add\", { href, resultHref: details });\r\n      setdown(true);\r\n    }\r\n    setPanding(false);\r\n  };\r\n  const opendevtool = async () => await ipcasync(\"init-devtool\");\r\n  const deleteAll = async () => {\r\n    setResult([]);\r\n    setPanding(`删除全部壁纸重新获取......`);\r\n    let res = await ipcasync(\"init-delete\");\r\n    res && _init();\r\n  };\r\n  const saveWallpaper = () => {\r\n    const filepath = showOpenDialogSync({\r\n      properties: [\"openDirectory\", \"createDirectory\", \"promptToCreate\"],\r\n    });\r\n    console.log(filepath);\r\n    setPath(filepath && filepath[0]);\r\n  };\r\n  const setWallpaper = async url => {\r\n    setPanding(\"正在设置桌面壁纸\");\r\n    try {\r\n      let res = await ipcasync(\"download\", { url, path });\r\n      wallpaper.set(res);\r\n      setPanding(false);\r\n    } catch (error) {\r\n      setPanding(false);\r\n      message.info(`网络异常未能全部下载成功`);\r\n    }\r\n  };\r\n  const newFind = async (str, name) => {\r\n    try {\r\n      setPanding(`正在添加${name}壁纸`);\r\n      let data = await getHomePage(str ? str : \"pc/\");\r\n      let { dataArry, add } = await ipcasync(\"init-day-data\", {\r\n        data,\r\n      });\r\n      message.info(`本次新增 ${add} 张`);\r\n      setResult(dataArry);\r\n    } catch (error) {\r\n      message.info(`加载失败`);\r\n      setResult([]);\r\n    }\r\n    setPanding(false);\r\n  };\r\n  const antIcon = <SyncOutlined spin style={{ fontSize: 24 }} />;\r\n  return (\r\n    <div id=\"app\">\r\n      {panding && (\r\n        <div className=\"loading\">\r\n          <Spin indicator={antIcon} tip={panding} size=\"large\" />\r\n        </div>\r\n      )}\r\n      {result.length > 0 ? (\r\n        <Content\r\n          {...{\r\n            result,\r\n            saveWallpaper,\r\n            setWallpaper,\r\n            handerchilden,\r\n            details,\r\n            setDetail,\r\n            Modals,\r\n            setModal,\r\n            setheadless,\r\n            headless,\r\n            openExternal,\r\n            opendevtool,\r\n            deleteAll,\r\n            newFind,\r\n            _init,\r\n            isdown,\r\n          }}\r\n        />\r\n      ) : (\r\n        <div className=\"loading\">\r\n          <Spin indicator={antIcon} tip=\"请稍后\" size=\"large\" />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\nexport default App;\r\n","F:\\code_git\\Today-wallpapers\\src\\Content\\Content.js",["26","27"],"import React from \"react\";\r\nimport { Modal, Button, Image, Collapse, message, BackTop } from \"antd\";\r\nimport {\r\n  FolderOpenFilled,\r\n  FormatPainterFilled,\r\n  EyeInvisibleOutlined,\r\n  DeleteOutlined,\r\n  EyeOutlined,\r\n  CodeOutlined,\r\n  GithubOutlined,\r\n  MenuOutlined,\r\n  FileImageFilled,\r\n  MehFilled,\r\n  AlertFilled,\r\n  CarFilled,\r\n  DribbbleCircleFilled,\r\n  BankFilled,\r\n  GitlabFilled,\r\n  YoutubeFilled,\r\n  SkinFilled,\r\n  GiftFilled,\r\n  StarFilled,\r\n  SendOutlined,\r\n  DownloadOutlined,\r\n  GlobalOutlined,\r\n} from \"@ant-design/icons\";\r\nconst { Panel } = Collapse;\r\nexport default ({\r\n  result,\r\n  saveWallpaper,\r\n  setWallpaper,\r\n  handerchilden,\r\n  details,\r\n  Modals,\r\n  setModal,\r\n  setDetail,\r\n  setheadless,\r\n  headless,\r\n  openExternal,\r\n  opendevtool,\r\n  deleteAll,\r\n  newFind,\r\n  _init,\r\n  isdown,\r\n}) => (\r\n  <div>\r\n    <div className=\"justify-content-center\">\r\n      {result.map(({ srcmini, title, href }, index) => (\r\n        <div className=\"mb-1 pics\" key={title + index}>\r\n          <div className=\"card\" onClick={() => handerchilden(title, href)}>\r\n            <img src={srcmini} />\r\n            <div className=\"content-overlay\"></div>\r\n            <div className=\"content\">\r\n              <p>{title}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n    <Modal\r\n      title={Modals}\r\n      width=\"550\"\r\n      visible={Modals}\r\n      onCancel={() => setModal(false)}\r\n      closable={false}\r\n      footer={[\r\n        <Button\r\n          key=\"back\"\r\n          onClick={() => {\r\n            setModal(false);\r\n            setDetail([]);\r\n          }}\r\n        >\r\n          Return\r\n        </Button>,\r\n      ]}\r\n      maskClosable={false}\r\n      style={{ top: 30 }}\r\n    >\r\n      <div className=\"Modalcon\">\r\n        {details.map(({ maxsrc, srcmini }, index) => (\r\n          <div key={index}>\r\n            <Image\r\n              width={200}\r\n              height={129}\r\n              src={srcmini}\r\n              className=\"Modalimage\"\r\n              preview={{\r\n                src: maxsrc,\r\n              }}\r\n            />\r\n            <div className=\"icons\">\r\n              <div className=\"txtIcons\">\r\n                {maxsrc.split(\"t_s\")[1]\r\n                  ? maxsrc.split(\"t_s\")[1].split(\"c5\")[0]\r\n                  : maxsrc.split(\"/\")[7]}\r\n              </div>\r\n              <FolderOpenFilled onClick={saveWallpaper} title=\"下载图片\" />\r\n              <FormatPainterFilled\r\n                onClick={() => setWallpaper(maxsrc)}\r\n                title=\"设置壁纸\"\r\n              />\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </Modal>\r\n    <Collapse ghost>\r\n      <Panel\r\n        header={<MenuOutlined title=\"风格\" />}\r\n        showArrow={false}\r\n        forceRender={true}\r\n        className=\"CollapseControl\"\r\n      >\r\n        <div className=\"typesIcon\">\r\n          <MehFilled onClick={() => newFind(\"dongman/\", \"动漫\")} title=\"动漫\" />\r\n          <BankFilled\r\n            onClick={() => newFind(\"jianzhu/\", \"建筑\")}\r\n            title=\"建筑\"\r\n          />\r\n          <GitlabFilled\r\n            onClick={() => newFind(\"dongwu/\", \"动物\")}\r\n            title=\"动物\"\r\n          />\r\n          <YoutubeFilled\r\n            onClick={() => newFind(\"meinv/\", \"美女\")}\r\n            title=\"美女\"\r\n          />\r\n          <SkinFilled onClick={() => newFind(\"jingwu/\", \"静物\")} title=\"静物\" />\r\n          <CarFilled onClick={() => newFind(\"qiche/\", \"汽车\")} title=\"汽车\" />\r\n          <GiftFilled onClick={() => newFind(\"jieri/\", \"节日\")} title=\"节日\" />\r\n          <StarFilled\r\n            onClick={() => newFind(\"xingzuo/\", \"星座\")}\r\n            title=\"星座\"\r\n          />\r\n          <FileImageFilled\r\n            onClick={() => newFind(\"fengjing/\", \"风景\")}\r\n            title=\"风景\"\r\n          />\r\n          <AlertFilled\r\n            onClick={() => newFind(\"chuangyi/\", \"创意\")}\r\n            title=\"创意\"\r\n          />\r\n          <DribbbleCircleFilled\r\n            onClick={() => newFind(\"tiyu/\", \"体育\")}\r\n            title=\"体育\"\r\n          />\r\n        </div>\r\n      </Panel>\r\n    </Collapse>\r\n\r\n    <div className=\"icons_fix\">\r\n      <BackTop>\r\n        <SendOutlined title=\"回到顶部\" className=\"upicon\" rotate={270} />\r\n      </BackTop>\r\n      <div\r\n        className=\"icons-num\"\r\n        onClick={() => message.info(`当前一共${result.length}套壁纸`)}\r\n      >\r\n        {result.length}\r\n      </div>\r\n      <DownloadOutlined\r\n        onClick={() =>\r\n          result.some(({ children }) => children.length) || isdown\r\n            ? _init(true)\r\n            : message.info(`未下载壁纸`)\r\n        }\r\n        title=\"已下载集合\"\r\n      />\r\n      <GlobalOutlined onClick={() => _init()} title=\"全部集合\" />\r\n      <CodeOutlined onClick={opendevtool} title=\"控制台\" />\r\n      {headless ? (\r\n        <EyeInvisibleOutlined\r\n          onClick={() => setheadless(false)}\r\n          title=\"显示爬虫\"\r\n        />\r\n      ) : (\r\n        <EyeOutlined onClick={() => setheadless(true)} title=\"隐藏爬虫\" />\r\n      )}\r\n      <GithubOutlined\r\n        onClick={() =>\r\n          openExternal(\r\n            \"https://github.com/blazer233/Today-wallpaper/tree/react-store-puppeteer\"\r\n          )\r\n        }\r\n        title=\"访问github\"\r\n      />\r\n      <DeleteOutlined\r\n        title=\"全部删除\"\r\n        onClick={() => {\r\n          Modal.error({\r\n            title: \"是否删除数据库全部数据\",\r\n            content: \"删除后无法恢复只能重新下载\",\r\n            onOk: deleteAll,\r\n            maskClosable: true,\r\n            okText: \"确认\",\r\n          });\r\n        }}\r\n      />\r\n    </div>\r\n  </div>\r\n);\r\n",{"ruleId":"28","replacedBy":"29"},{"ruleId":"30","replacedBy":"31"},{"ruleId":"32","severity":1,"message":"33","line":3,"column":1,"nodeType":"34","endLine":5,"endColumn":3},{"ruleId":"35","severity":1,"message":"36","line":42,"column":28,"nodeType":"37","endLine":42,"endColumn":30,"suggestions":"38"},{"ruleId":"32","severity":1,"message":"33","line":28,"column":1,"nodeType":"34","endLine":202,"endColumn":3},{"ruleId":"39","severity":1,"message":"40","line":51,"column":13,"nodeType":"41","endLine":51,"endColumn":34},"no-native-reassign",["42"],"no-negated-in-lhs",["43"],"import/no-anonymous-default-export","Assign arrow function to a variable before exporting as module default","ExportDefaultDeclaration","react-hooks/exhaustive-deps","React Hook useEffect has a missing dependency: '_init'. Either include it or remove the dependency array.","ArrayExpression",["44"],"jsx-a11y/alt-text","img elements must have an alt prop, either with meaningful text, or an empty string for decorative images.","JSXOpeningElement","no-global-assign","no-unsafe-negation",{"desc":"45","fix":"46"},"Update the dependencies array to be: [_init]",{"range":"47","text":"48"},[1464,1466],"[_init]"]